"0",""
"0","pairedOPM_CCF <- function(wideIDfeatures){"
"0",""
"0","final_df_particular_CCF_Object <- data.frame()  "
"0","  "
"0","  library(stringr)  "
"0","  #one liner to get unique cellIDs Features from colnames of wide dataframe"
"0","  listOfccfCellIDs <- unique(as.data.frame(str_split_fixed(colnames(wideIDfeatures[-1]), ""_FeatureID_"",2))[,1]) # about 250 cells"
"0","  "
"0","  listOFccFFeatures <- unique(as.data.frame(str_split_fixed(colnames(wideIDfeatures[-1]), ""_FeatureID_"",2))[,2])"
"0","  listOFccFFeatures"
"0","  #select only features that are present for BOTH cell and nucleus"
"0","  # nc_listOFccFFeatures <- listOFccFFea"
"0","  "
"0","  nc_listOFccFFeatures <-  as.data.frame(listOFccFFeatures) %>%"
"0","    dplyr::filter(grepl(""_cell|_nucleus"",listOFccFFeatures))"
"0","  "
"0","  nc_listOFccFFeatures"
"0","#remove nucleus and cell from feature names"
"0",""
"0","  sub_nc_listOFccFFeatures <- gsub(""_nucleus|_cell"","""",nc_listOFccFFeatures$listOFccFFeatures)"
"0","  "
"0","#reassign list of features"
"0","  vector_nc_listOFccFFeatures <- sub_nc_listOFccFFeatures"
"0",""
"0","  #make unique as features duplicated due to removal of Cell/nucleus suffix  29/11/21"
"0","  vector_nc_listOFccFFeatures <- unique(vector_nc_listOFccFFeatures)"
"0","  "
"0","  #loop through feature in list"
"0","  for(sub_chosenFeature in vector_nc_listOFccFFeatures){"
"0","  "
"0","  an_chosenFeatureCell <- paste0(sub_chosenFeature,""_cell"")"
"0","  an_chosenFeatureNucleus <- paste0(sub_chosenFeature,""_nucleus"")"
"0","  #now paste rownames back onto feature of interest"
"0","  "
"0","#Loop through all features"
"0","  "
"0","  "
"0","#Loop through all cells"
"0","for(cellID in listOfccfCellIDs){"
"0"," "
"0","    print(paste(""STARTing cell.."",cellID, "" With feature..."",sub_chosenFeature))"
"0","  "
"0","  "
"0","lookupCell <-   paste0(cellID,'_FeatureID_',an_chosenFeatureCell)"
"0","lookupNucleus <-  paste0(cellID,'_FeatureID_',an_chosenFeatureNucleus)"
"0","     "
"0","  #subset by column name"
"0","    "
"0","library(dplyr)"
"0","#NB Using ""pull"" here to make data into vector isntead of dataframe but this function might be slow"
"0","  chosenTSone_y_cell <- pull(wideIDfeatures[,lookupCell])"
"0","  # chosenTSone_y_cell"
"0","  choseTStwo_x_nucleus <- pull(wideIDfeatures[,lookupNucleus])"
"0","  "
"0","  "
"0","  "
"0","  #generate CCF"
"0","  particularCellFeatureCCF <- ccf(chosenTSone_y_cell, choseTStwo_x_nucleus, plot = FALSE, na.action = na.pass)"
"0","  str(particularCellFeatureCCF)"
"0",""
"0","  #make an object ID"
"0","# particular_CCF_ObjectID <- rep(paste)"
"0",""
"0","anCCF_ACF <- particularCellFeatureCCF$acf"
"0","anCCF_LAG <- particularCellFeatureCCF$lag"
"0",""
"0","an_CCF_ObjectID <- paste(rep(cellID, length(particularCellFeatureCCF$lag)))"
"0","an_CCF_Feature <- sub_chosenFeature"
"0",""
"0","# particular_acfObjectTreatment <- rep(rep(paste(titlePlot), length(particular_acfObject$acf))) "
"0","particular_CCF_Object_output <- data.frame(anCCF_ACF , anCCF_LAG, an_CCF_ObjectID, an_CCF_Feature)"
"0",""
"0","print(paste(""adding Cell to dataframe..."",cellID))"
"0","final_df_particular_CCF_Object <- rbind(final_df_particular_CCF_Object, particular_CCF_Object_output)"
"0","    print(paste(""ENDing cell.."",cellID, "" With feature..."",sub_chosenFeature))"
"0",""
"0","}"
"0","  "
"0",""
"0","  }"
"0","return(final_df_particular_CCF_Object)"
"0","  }"
"0","# final_df_particular_CCF_Object"
"0","# wide_cellID_geomFeature"
"0",""
"0","# for(cell in ListOfAllCells)"
"0","# wide_cellID_geomFeature"
