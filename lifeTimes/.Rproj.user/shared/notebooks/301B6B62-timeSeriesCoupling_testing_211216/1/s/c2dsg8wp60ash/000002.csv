"0","```r

#changes on 1 12 21

join_outputCCFdata$lagRange <- ifelse(diff_join_outputCCFdata$anCCF_LAG >-15 & diff_join_outputCCFdata$anCCF_LAG <0 , \"negativeLAG\",
                                           ifelse(diff_join_outputCCFdata$anCCF_LAG >0 & diff_join_outputCCFdata$anCCF_LAG <15, \"positiveLAG\", 
                                                  ifelse(diff_join_outputCCFdata$anCCF_LAG == 0, \"zeroLAG\", \"OutOfLagRange\")))



# # Define ranges of lags around zero
# join_outputCCFdata$lagRange <- ifelse(join_outputCCFdata$anCCF_LAG >-15 & join_outputCCFdata$anCCF_LAG <0 , \"negativeLAG\",
#                                            ifelse(join_outputCCFdata$anCCF_LAG >0 & join_outputCCFdata$anCCF_LAG <15, \"positiveLAG\",
#                                                   \"zeroLAG\"))

library(dplyr)

# join_outputCCFdata$lagRange

#calculate averages in lags (not in lag Diffs)
meanLagRange_join_outputCCFdata <- join_outputCCFdata %>%
    arrange(an_CCF_ObjectID,an_CCF_Feature, Treatment,anCCF_LAG)%>%
    group_by(an_CCF_ObjectID, an_CCF_Feature,Treatment, lagRange) %>%
  dplyr::summarise(meanACFforLAG = mean(anCCF_ACF, na.rm = TRUE))

meanLagRange_join_outputCCFdata

library(tidyr)
wider_meanLagRange_join_outputCCFdata <- pivot_wider(meanLagRange_join_outputCCFdata,
                          id_cols = c(\"an_CCF_ObjectID\",\"an_CCF_Feature\",\"Treatment\",\"meanACFforLAG\",\"lagRange\"),
                          names_from = \"lagRange\",
                          values_from = \"meanACFforLAG\") 

str(wider_meanLagRange_join_outputCCFdata)

wider_meanLagRange_join_outputCCFdata$meanPrior_meanPost_diff <- wider_meanLagRange_join_outputCCFdata$negativeLAG - wider_meanLagRange_join_outputCCFdata$positiveLAG  

# wider_meanLagRange_join_outputCCFdata
wider_meanLagRange_join_outputCCFdata

# str(wider_meanLagRange_join_outputCCFdata$meanPrior_meanPost_diff)

wider_meanLagRange_join_outputCCFdata$priorToPostRatio <- wider_meanLagRange_join_outputCCFdata$negativeLAG/wider_meanLagRange_join_outputCCFdata$positiveLAG

colnames(wider_meanLagRange_join_outputCCFdata)

#join prior to post ratio back to dataframe
join_meanLagRange_join_outputCCFdata <- left_join(summary_meandiff_overLAGrange_join_outputCCFdata, wider_meanLagRange_join_outputCCFdata[,c(1,2,3,7,8)], by = c(\"an_CCF_ObjectID\",\"an_CCF_Feature\",\"Treatment\"))

# wider_meanLagRange_join_outputCCFdata
dim(meanLagRange_join_outputCCFdata)
dim(join_meanLagRange_join_outputCCFdata)


# -1.876928e-01 -0.0756655222


#get overall feature mean

# join_meanLagRange_join_outputCCFdata$meanAbsLAGdiff
summaryOfMedianDifferencePriorAndPost<- join_meanLagRange_join_outputCCFdata %>%
  group_by(an_CCF_Feature,Treatment)%>%
  summarise(medianPrePostPerTF = median(meanPrior_meanPost_diff))


summaryOfMedianDifferencePriorAndPost


join_medianDiff_meanLagRange_join_outputCCFdata <- left_join(join_meanLagRange_join_outputCCFdata, summaryOfMedianDifferencePriorAndPost, by = c(\"an_CCF_Feature\",\"Treatment\"))
dim(join_meanLagRange_join_outputCCFdata)
dim(join_medianDiff_meanLagRange_join_outputCCFdata)

```"
